# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- script: echo Compilar y correr las pruebas unitariasaa
- script: sudo mkdir ~/.ssh
- script: sudo chmod 777 ~/.ssh
- script: sudo echo $ID_AZURE
- script: (umask  077 ; echo $ID_AZURE | base64 --decode --ignore-garbage > ~/.ssh/id_azure)
- script: sudo ls -la ~/.ssh
- script: sudo chmod 400 ~/.ssh/id_azure
- script: sudo cat ~/.ssh/id_azure
- script: sudo touch ~/.ssh/known_hosts
- script: sudo  cat ~/.ssh/known_hosts
- script:  sudo chown vsts:root ~/.ssh
- script:  sudo chown -R vsts:root ~/.ssh/
- script: sudo chmod 400 ~/.ssh/id_azure
- script: sudo chmod 400 ~/.ssh/known_hosts
- script: sudo base64 --version
- script: sudo ssh -i ~/.ssh/id_azure azureuser@13.84.202.197
- script:  sbt compile
- script:  sbt rpm:packageBin
- script:  sudo ls -la /home/vsts/work/1/s/gcs-app/target/rpm/RPMS/noarch/
- script:  sudo scp -i ssh -i /home/vsts/.ssh/id_azure /home/vsts/work/1/s/gcs-app/target/rpm/RPMS/noarch/gcs-app-2.8.x-1.noarch.rpm azureuser@13.84.202.197:/home/azureuser
  displayName: 'Commit Check'
